@model List<ResultBookingViewModel>
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/AdminLayout/Index.cshtml";
   
}

@section ScriptsAdmin {
    <script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script type="text/javascript">
        $(document).ready(() => {
            var connection = new signalR.HubConnectionBuilder()
                .withAutomaticReconnect()
                .withUrl("https://localhost:7146/SignalRHub").build();




            start();

            function start() {
                connection.start()
                    .then(function () {
                        $("#loading").hide();

                        setInterval(() => {
                            connection.invoke("GetBookingList");
                        }, 1000);

                        $("#conStatus").text("Bağlantı Açık");
                    })
                    .catch(function (err) {
                        console.error(err.toString());
                        $("#conStatus").text("Bağlantı Hatası");
                        setTimeout(() => start(), 2000)
                    });
            }


            connection.onreconnecting(err => {
                $("#loading").show();
                $("#conStatus").text("Bağlantı Bekleniyor");
                console.log("onreconnecting:" + err);
            });

            connection.onreconnected(connectionId => {
                $("#loading").hide();
                $("#conStatus").text("Bağlantı Başarılı");
                console.log("connectionId:" + connectionId);

            });

            connection.onclose(() => {
                $("#loading").hide();
                $("#conStatus").text("Bağlantı Hatası");
                Start();
            });



            connection.on("@ViewBag.TypeBooking", (value) => {
                console.log(value);

                var tbody = document.querySelector('tbody');
                tbody.innerHTML = '';


                value.forEach(function (item, index) {
                    var row = '<tr>' +
                        '<th scope="row">' + (index + 1) + '</th>' +
                        '<td>' + item.name + '</td>' +
                        '<td>' + item.phone + '</td>' +
                        '<td>' + item.personCount + '</td>' +
                        '<td>' + item.status + '</td>' +
                        '<td><a href="/Booking/DeleteBooking/' + item.id + '" class="btn btn-outline-danger">Sil</a></td>' +
                        '<td><a href="/Booking/UpdateBooking/' + item.id + '" class="btn btn-outline-success">Güncelle</a></td>' +
                        '</tr>';
                    tbody.innerHTML += row;
                });
            });

            

        });
    </script>
}
<div class="content">
    <div class="container-fluid">
        <h4 class="page-title">Rezervasyon İşlemleri</h4>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Rezervasyon Listesi</div>
                    </div>
                    <div class="card-body">
                        <div class="card-sub">
                            Rezervasyonlar ile ilgili işlemleri aşağıdan gerçekleştirebilirsiniz.
                        </div>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Ad Soyad</th>
                                        <th>Telefon</th>
                                        <th>Kişi Sayısı</th>
                                        <th>Rezervasyon Durumu</th>
                                        <th>Sil</th>
                                        <th>Güncelle</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                            <a href="/Booking/CreateBooking/" class="btn btn-outline-info">Yeni Rezervasyon Girişi</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>


