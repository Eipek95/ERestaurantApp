@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/AdminLayout/Index.cshtml";
}

<style>
    .table thead th {
        color: #23CCEF;
        border-bottom-width: 2px;
    }

    .table tbody tr {
        color: whitesmoke;

    }
</style>

<h1>Dashboard</h1>

<div class="container-fluid">
    <h4 class="page-title">Dashboard</h4>
    <div class="row">
        <div class="col-md-3">
            <div class="card card-warning">
                <div class="card-header">
                    <h6>  <i class="la la-bar-chart"></i> Günlük Satışlar</h6>
                </div>
                <div class="card-body" style="text-align: right;">
                    <h2 class="card-title">10,500 ₺</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card card-success">
                <div class="card-header">
                    <h6><i class="la la-bar-chart"></i> Günlük Online Satışlar</h6>
                </div>
                <div class="card-body" style="text-align: right;">
                    <h2 class="card-title">5,800 ₺</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card card-danger">
                <div class="card-header">
                    <h6><i class="la la-newspaper-o"></i> Popüler Menü Ürünleri</h6>
                </div>
                <div class="card-body" style="text-align: right;">
                    <h2 class="card-title">Pizza, Hamburger</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card card-primary">
                <div class="card-header">
                    <h6> <i class="la la-check-circle"></i> Son 10 Sipariş</h6>
                </div>
                <div class="card-body" style="text-align: right;">
                    <h2 class="card-title">10 Sipariş</h2>
                </div>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-line"></i> Haftalık Satış Grafiği (Pazartesi - Pazar)
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="weeklySalesLineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between">
                    <p><i class="fas fa-chart-bar"></i> <b id="selectedDate"></b>  Tarihine ait Günlük Satış Sütun Grafiği </p>
                    <input type="date" class="form-class" id="datePicker"/>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="columnChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-pie-chart"></i> Kategoriye Göre Ürün Dağılımı
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-area"></i> Zamanla Satış Trendleri
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-area"></i> Son 10 Sipariş
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover table-bordered-bd-default table-dark">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Müşteri Adı</th>
                                    <th>Toplam Tutar</th>
                                    <th>Tarih</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    
      $(document).ready(function() {
        // Haftalık satış verilerini almak için GET isteği gönder
        $.ajax({
            url: '/AdminLayout/Json3', 
            method: 'GET',
            success: function(data) {
                var parsedData = JSON.parse(data); 

                // Günleri ve satılan ürün miktarlarını ayıkla
                var labels = parsedData.map(function(item) {
                    var date = new Date(item.date); // Verilen tarihi Date formatına çevir
                    return date.toLocaleDateString('tr-TR', { weekday: 'long' }); // Pazartesi, Salı vb. günleri göster
                });

                var totalQuantitySold = parsedData.map(function(item) {
                    return item.totalQuantitySold;
                });

                // Haftalık satış çizgi grafiğini oluştur
                var weeklySalesLineChart = new Chart(document.getElementById('weeklySalesLineChart'), {
                    type: 'line', // Çizgi grafiği tipi
                    data: {
                        labels: labels, // Günler (Pazartesi - Pazar)
                        datasets: [{
                            label: 'Günlük Satılan Ürünler (Adet)',
                            data: totalQuantitySold, // Satış miktarları
                            backgroundColor: 'rgba(75, 192, 192, 0.2)', // Doldurma rengi
                            borderColor: 'rgba(75, 192, 192, 1)', // Çizgi rengi
                            borderWidth: 2,
                            fill: true, // Çizginin altını doldur
                            tension: 1// Çizgiyi yumuşat
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true // Y ekseni sıfırdan başlasın
                            }
                        }
                    }
                });
            },
            error: function(xhr, status, error) {
                console.error('Hata: ', error);
            }
        });
    });

    // Sütun Grafiği Verisi
    document.getElementById('datePicker').valueAsDate = new Date();
document.getElementById('selectedDate').innerText = new Date().toLocaleDateString();

var columnChart; // Grafiği global bir değişken olarak tanımla

function loadChart(date) {
    $.ajax({
        url: '/AdminLayout/Json2?date=' + date, // Tarihi parametre olarak gönder
        method: 'GET',
        success: function(data) {
            var parsedData = JSON.parse(data);

            // Ürün adlarını ve satılan miktarları ayrıştır
            var labels = parsedData.map(function(item) {
                return item.productName;
            });

            var totalQuantitySold = parsedData.map(function(item) {
                return item.totalQuantitySold;
            });

            // Eğer bir önceki grafik varsa, önce onu yok et
            if (columnChart) {
                columnChart.destroy();
            }

            // Sütun grafiği oluştur
            columnChart = new Chart(document.getElementById('columnChart'), {
                type: 'bar',
                data: {
                    labels: labels, 
                    datasets: [{
                        label: 'Günlük Satışlar (Adet)',
                        data: totalQuantitySold, 
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        },
        error: function(xhr, status, error) {
            console.error('Hata: ', error);
        }
    });
}

$(document).ready(function() {
    // Sayfa yüklendiğinde bugünün tarihiyle grafiği yükle
    var today = document.getElementById('datePicker').value;
    loadChart(today);

    // DatePicker değiştiğinde grafiği güncelle ve seçilen tarihi başlıkta göster
    $('#datePicker').change(function() {
        var selectedDate = this.value;
        document.getElementById('selectedDate').innerText = new Date(selectedDate).toLocaleDateString();
        loadChart(selectedDate); // Yeni tarih ile grafiği yenile
    });
});
    
    // Pasta Grafiği Verisi
    var pieData = {
        labels: [], // Dinamik olarak doldurulacak
        datasets: [{
            data: [], // Dinamik olarak doldurulacak
            backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(75, 192, 192, 0.5)',
                'rgba(153, 102, 255, 0.5)',
                'rgba(255, 159, 64, 0.5)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    };

    var pieChart = new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: pieData,
        options: {
            responsive: true
        }
    });

    // Sayfa yüklendiğinde AJAX çağrısını başlat
    $(document).ready(function () {
        $.ajax({
            url: '/AdminLayout/Json1', // Controller adını doğru şekilde ekle
            type: 'GET',
            success: function (data) {
                var jsonData = JSON.parse(data);
                var labels = [];
                var productCounts = [];

                jsonData.forEach(function (category) {
                    labels.push(category.categoryName);
                    productCounts.push(category.productCount);
                });

                pieChart.data.labels = labels;
                pieChart.data.datasets[0].data = productCounts;
                pieChart.update();
            },
            error: function (xhr, status, error) {
                console.error('AJAX Error: ' + status + error);
            }
        });
    });

   

    // Zamanla Satış Trendleri Verisi
    const salesData = [1500, 2000, 1800, 2200, 2400, 3000, 3200, 2800, 3500];
    var lineChart = new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: ['1. Hafta', '2. Hafta', '3. Hafta', '4. Hafta', '5. Hafta', '6. Hafta', '7. Hafta', '8. Hafta', '9. Hafta'],
            datasets: [{
                label: 'Aylık Satışlar',
                data: salesData,
                backgroundColor: 'rgba(255, 159, 64, 0.5)',
                borderColor: 'rgba(255, 159, 64, 1)',
                borderWidth: 2,
                fill: true
            }]
        },
        options: {
            responsive: true
        }
    });

    // Sipariş Verileri
    const orders = [
        { orderId: 1, customerName: 'Ali Veli', totalAmount: 150, date: '2023-10-01' },
        { orderId: 2, customerName: 'Ayşe Yılmaz', totalAmount: 300, date: '2023-10-02' },
        { orderId: 3, customerName: 'Mehmet Demir', totalAmount: 200, date: '2023-10-03' },
        { orderId: 4, customerName: 'Fatma Çelik', totalAmount: 250, date: '2023-10-04' },
        { orderId: 5, customerName: 'Ahmet Can', totalAmount: 300, date: '2023-10-05' },
        { orderId: 6, customerName: 'Zeynep Kaya', totalAmount: 350, date: '2023-10-06' },
        { orderId: 7, customerName: 'Emre Polat', totalAmount: 400, date: '2023-10-07' },
        { orderId: 8, customerName: 'Selin Tekin', totalAmount: 450, date: '2023-10-08' },
        { orderId: 9, customerName: 'Oğuzhan Aydın', totalAmount: 500, date: '2023-10-09' },
        { orderId: 10, customerName: 'Ceren Yurt', totalAmount: 550, date: '2023-10-10' }
    ];

    // Siparişleri tabloya ekleme
    const ordersTable = document.getElementById('ordersTable');
    orders.forEach(order => {
        const row = `<tr>
                            <td>${order.orderId}</td>
                            <td>${order.customerName}</td>
                            <td>${order.totalAmount} TL</td>
                            <td>${order.date}</td>
                         </tr>`;
        ordersTable.innerHTML += row;
    });

    
</script>
